<!DOCTYPE struts PUBLIC "-//Apache Software Foundation//DTD Struts Configuration 2.5//EN"  "http://struts.apache.org/dtds/struts-2.5.dtd">
<struts>


	<package name="classroom" namespace="/api/api"
		extends="json-default">

		<interceptors>
			<interceptor name="authInterceptor"
				class="com.testcreator.interceptors.AuthenticationInterceptor" />
			<interceptor name="jsonExceptionInterceptor"
				class="com.testcreator.interceptors.JsonApiExceptionInterceptor" />
			<interceptor name="classroomIdInterceptor"
				class="com.testcreator.interceptors.ClassroomIdInterceptor" />
			<interceptor-stack name="apiStack">
				<interceptor-ref name="servletConfig" />
				<interceptor-ref name="authInterceptor" />
				<interceptor-ref name="modelDriven" />
				<interceptor-ref name="jsonExceptionInterceptor" />
				<interceptor-ref name="json" />
				<interceptor-ref name="params" />
				<interceptor-ref name="validation" />
				<interceptor-ref name="workflow" />
			</interceptor-stack>

		</interceptors>

		<default-interceptor-ref name="apiStack" />

		<global-results>
			<result name="invalidJson" type="json">
				<param name="root">error</param>
				<param name="statusCode">400</param>
				<param name="excludeNullProperties">true</param>
			</result>
			<result name="error" type="json">
				<param name="root">error</param>
				<param name="statusCode">400</param>
				<param name="excludeNullProperties">true</param>
			</result>
			<result name="input" type="json">
				<param name="root">error</param>
				<param name="statusCode">400</param>
				<param name="excludeNullProperties">true</param>
			</result>
			<result name="login" type="json">
				<param name="root">error</param>
				<param name="statusCode">401</param>
				<param name="excludeNullProperties">true</param>
			</result>
			<result name="notFound" type="json">
				<param name="root">error</param>
				<param name="statusCode">404</param>
				<param name="excludeNullProperties">true</param>
			</result>
			<result name="forbidden" type="json">
				<param name="root">error</param>
				<param name="statusCode">403</param>
				<param name="excludeNullProperties">true</param>
			</result>
		</global-results>

		<global-exception-mappings>
			<exception-mapping result="invalidJson"
				exception="org.apache.struts2.json.JSONException" />
		</global-exception-mappings>


		<action name="create-classroom"
			class="com.testcreator.actions.ClassroomAction"
			method="createClassroom">
			<result name="success" type="json">
				<param name="root">classroomDto</param>
				<param name="excludeNullProperties">true</param>
			</result>
		</action>

		<action name="created-classrooms"
			class="com.testcreator.actions.ClassroomAction"
			method="allCreatedClassrooms">
			<result name="success" type="json">
				<param name="root">createdClassrooms</param>
				<param name="excludeNullProperties">true</param>
			</result>
		</action>

		<action name="joined-classrooms"
			class="com.testcreator.actions.ClassroomAction"
			method="allJoinedClassrooms">
			<result name="success" type="json">
				<param name="root">joinedClassrooms</param>
				<param name="excludeNullProperties">true</param>
			</result>
		</action>

		<action name="delete-classroom"
			class="com.testcreator.actions.ClassroomAction"
			method="deleteClassroom">
			<result name="success" type="json">
				<param name="root">successDto</param>
			</result>
		</action>

		<action name="rename-classroom"
			class="com.testcreator.actions.ClassroomAction"
			method="renameClassroom">
			<result name="success" type="json">
				<param name="root">successDto</param>
			</result>
		</action>

		<!-- currently not needed -->
		<action name="isLoggedin"
			class="com.testcreator.actions.AuthAction" method="isValidToken">
			<result name="success" type="json">
				<param name="root">status</param>
			</result>
		</action>

		<action name="classroomdetails"
			class="com.testcreator.actions.ClassroomAction"
			method="getClassroomDetails">
			<result name="success" type="json">
				<param name="root">classroomDto</param>
			</result>
		</action>

		<action name="students"
			class="com.testcreator.actions.ClassroomAction"
			method="fetchClassroomStudents">
			<result name="success" type="json">
				<param name="root">classroomUsers</param>
				<param name="excludeNullProperties">true</param>
			</result>
			<interceptor-ref name="apiStack" />
			<interceptor-ref name="classroomIdInterceptor" />
		</action>

		<action name="classroomcount"
			class="com.testcreator.actions.TestAction" method="getTestCount">
			<result name="success" type="json">
				<param name="root">testDto</param>
				<param name="excludeNullProperties">true</param>
			</result>
			<interceptor-ref name="classroomIdInterceptor" />

		</action>

		<action name="inviteLink"
			class="com.testcreator.actions.ClassroomAction" method="inviteLink">
			<result name="success" type="json">
				<param name="root">classroomDto</param>
				<param name="excludeNullProperties">true</param>
			</result>
			<interceptor-ref name="apiStack" />
			<interceptor-ref name="classroomIdInterceptor" />
		</action>

		<action name="updateInviteLink"
			class="com.testcreator.actions.ClassroomAction"
			method="updateInviteLink">
			<result name="success" type="json">
				<param name="root">classroomDto</param>
				<param name="excludeNullProperties">true</param>
			</result>
			<interceptor-ref name="apiStack" />
			<interceptor-ref name="classroomIdInterceptor" />
		</action>




	</package>

	<package name="tests" namespace="/api/api/tests"
		extends="classroom">


		<interceptors>


			<interceptor name="testIdInterceptor"
				class="com.testcreator.interceptors.TestIdInterceptor" />

			<interceptor-stack name="testActionStack">
				<interceptor-ref name="apiStack" />
				<interceptor-ref name="classroomIdInterceptor" />
			</interceptor-stack>

		</interceptors>

		<default-interceptor-ref
			name="testActionStack" />

		<action name="create-test"
			class="com.testcreator.actions.TestAction" method="createTest">
			<result name="success" type="json">
				<param name="root">testDto</param>
				<param name="excludeNullProperties">true</param>
			</result>
		</action>



		<action name="get-created-tests"
			class="com.testcreator.actions.TestAction" method="fetchCreatedTests">

			<result name="success" type="json">
				<param name="root">allTests</param>
				<param name="excludeNullProperties">true</param>
			</result>

		</action>

		<action name="createQuestion"
			class="com.testcreator.actions.TestAction" method="createQuestion">

			<result name="success" type="json">
				<param name="root">questionDto</param>
				<param name="excludeNullProperties">true</param>
			</result>
			<result name="input" type="json">
				<param name="root">fieldErrors</param>
			</result>
			<interceptor-ref name="testActionStack" />
			<interceptor-ref name="testIdInterceptor" />
		</action>

		<action name="getQuestion"
			class="com.testcreator.actions.TestAction"
			method="fetchQuestionWithOption">
			<result name="success" type="json">
				<param name="root">questionDto</param>
				<param name="excludeNullProperties">true</param>
			</result>
		</action>

		<action name="deleteQuestion"
			class="com.testcreator.actions.TestAction" method="deleteQuestion">
			<result name="success" type="json">
				<param name="root">successDto</param>
			</result>
		</action>

		<action name="deleteTest"
			class="com.testcreator.actions.TestAction" method="deleteTest">
			<result name="success" type="json">
				<param name="root">successDto</param>
			</result>
			<interceptor-ref name="testActionStack" />
			<interceptor-ref name="testIdInterceptor" />
		</action>

		<action name="renameTest"
			class="com.testcreator.actions.TestAction" method="renameTest">
			<result name="success" type="json">
				<param name="root">successDto</param>
			</result>
			<interceptor-ref name="testActionStack" />
			<interceptor-ref name="testIdInterceptor" />
		</action>

		<action name="publishTest"
			class="com.testcreator.actions.TestAction" method="publishTest">
			<result name="success" type="json">
				<param name="root">successDto</param>
			</result>
			<result name="input" type="json">
				<param name="root">fieldErrors</param>
			</result>
			<interceptor-ref name="testActionStack" />
			<interceptor-ref name="testIdInterceptor" />
		</action>

		<action name="unPublishTest"
			class="com.testcreator.actions.TestAction" method="unPublishTest">
			<result name="success" type="json">
				<param name="root">successDto</param>
			</result>
			<result name="input" type="json">
				<param name="root">fieldErrors</param>
			</result>
			<interceptor-ref name="testActionStack" />
			<interceptor-ref name="testIdInterceptor" />
		</action>

		<action name="delete-option"
			class="com.testcreator.actions.TestAction" method="deleteOption">
			<result name="success" type="json">
				<param name="root">successDto</param>
			</result>
		</action>

		<action name="updateQuestion"
			class="com.testcreator.actions.TestAction" method="updateQuestion">
			<result name="success" type="json">
				<param name="root">successDto</param>
			</result>
			<result name="input" type="json">
				<param name="root">fieldErrors</param>
				<param name="statusCode">400</param>
			</result>
		</action>


		<action name="getTestQuestions"
			class="com.testcreator.actions.TestAction" method="fetchTestQuestion">

			<result name="success" type="json">
				<param name="root">testDto.questions</param>
				<param name="excludeNullProperties">true</param>
			</result>
			<interceptor-ref name="testActionStack" />
			<interceptor-ref name="testIdInterceptor" />
		</action>

	</package>

	<package name="joinEndPoints" namespace="/api/join"
		extends="classroom">


		<action name="classroom"
			class="com.testcreator.actions.JoinClassroomAction"
			method="getClassroom">
			<result name="success" type="json">
				<param name="root">classroomDto</param>
				<param name="excludeNullProperties">true</param>
			</result>
			<result name="input" type="json">
				<param name="root">fieldErrors</param>
			</result>
		</action>


		<action name="classroomConfirm"
			class="com.testcreator.actions.JoinClassroomAction"
			method="joinClassroom">
			<result name="success" type="json">
				<param name="root">classroomDto</param>
				<param name="excludeNullProperties">true</param>
			</result>
			<result name="redirect" type="json">
				<param name="root">classroomDto</param>
				<param name="excludeNullProperties">true</param>
				<param name="statusCode">301</param>
			</result>
			<result name="input" type="json">
				<param name="root">fieldErrors</param>
			</result>
		</action>

	</package>

	<package name="authentication" namespace="/api"
		extends="json-default">
		<interceptors>
			<interceptor name="jsonExceptionInterceptor"
				class="com.testcreator.interceptors.JsonApiExceptionInterceptor" />
			<interceptor-stack name="authenticationStack">
				<interceptor-ref name="jsonExceptionInterceptor" />
				<interceptor-ref name="json" />
				<interceptor-ref name="defaultStack" />
			</interceptor-stack>
		</interceptors>

		<default-interceptor-ref
			name="authenticationStack" />

		<global-results>
			<result name="invalidJson" type="json">
				<param name="root">error</param>
				<param name="statusCode">400</param>
			</result>
			<result name="error" type="json">
				<param name="root">error</param>
				<param name="statusCode">500</param>
			</result>
			<result name="input" type="json">
				<param name="root">error</param>
				<param name="statusCode">400</param>
			</result>
			<result name="duplicate" type="json">
				<param name="root">error</param>
				<param name="statusCode">409</param>
			</result>
			<result name="login" type="json">
				<param name="root">error</param>
				<param name="statusCode">401</param>
			</result>
		</global-results>

		<global-exception-mappings>
			<exception-mapping result="invalidJson"
				exception="org.apache.struts2.json.JSONException" />
		</global-exception-mappings>

		<action name="signin"
			class="com.testcreator.actions.UserAction" method="signin">
			<result name="success" type="json">
				<param name="root">authDto</param>
				<param name="excludeNullProperties">true</param>
			</result>
		</action>

		<action name="signup"
			class="com.testcreator.actions.UserAction" method="signup">
			<result name="success" type="json">
				<param name="root">authDto</param>
				<param name="excludeNullProperties">true</param>
			</result>
		</action>

	</package>

	<package name="studentPortal" namespace="/api/studenttest"
		extends="classroom">

		<interceptors>
			<interceptor-stack name="studentStack">
				<interceptor-ref name="apiStack" />
				<interceptor-ref name="classroomIdInterceptor" />
			</interceptor-stack>
		</interceptors>

		<default-interceptor-ref name="studentStack" />

		<action name="getStudentTests"
			class="com.testcreator.actions.StudentTestAction"
			method="getNewTests">

			<result name="success" type="json">
				<param name="root">testDto</param>
				<param name="excludeNullProperties">true</param>
			</result>

		</action>

	</package>

	<package name="timedtest" namespace="/api/timedtest"
		extends="studentPortal">

		<interceptors>


			<interceptor name="testIdInterceptor"
				class="com.testcreator.interceptors.TestIdInterceptor" />

			<interceptor-stack name="timedTestStack">
				<interceptor-ref name="studentStack" />
				<interceptor-ref name="testIdInterceptor" />
			</interceptor-stack>

		</interceptors>

		<default-interceptor-ref name="timedTestStack" />

		<action name="start"
			class="com.testcreator.actions.TimedTestAction" method="startTest">
			<result name="success" type="json">
				<param name="root">startTestDto</param>
			</result>
		</action>
	</package>

</struts>